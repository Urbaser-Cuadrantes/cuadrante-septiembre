<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cuadrante â€“ Septiembre 2025</title>
<style>
:root { --bg:#f6f8fb; --card:#fff; --text:#222; --muted:#6b7280; --brand:#2563eb; --border:#e5e7eb; --sticky:#f3f6fb; }
html,body { margin:0; padding:0; background:var(--bg); color:var(--text); font-family: Calibri, Arial, system-ui; }
.container { max-width: 1400px; margin: 24px auto; padding: 0 16px; }
.header { display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-bottom:12px; }
h1 { font-size: 20px; margin:0; }
.controls { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
table { border-collapse: collapse; width: 100%; }
th, td { border: 1px solid var(--border); padding: 6px 8px; text-align: center; }
th.sticky { position: sticky; top: 0; background: var(--sticky); z-index: 2; }
td.name, th.name { text-align: left; min-width: 240px; position: sticky; left: 0; background: #fff; z-index: 3; }
td.turno { min-width: 34px; }
.legend { margin-top: 16px; display:grid; grid-template-columns: repeat(3, minmax(240px,1fr)); gap:8px; }
.legend .item { display:flex; align-items:center; gap:8px; }
.legend .swatch { width:16px; height:16px; border-radius:4px; border:1px solid #ccc; }
.notice { font-size:12px; color:var(--muted); }
.btn { padding:8px 10px; border-radius:8px; border:1px solid var(--border); background:#fff; cursor:pointer; }
.btn.primary { background: var(--brand); color:#fff; border-color:transparent; }
.table-wrap { overflow:auto; max-height:70vh; }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Cuadrante â€“ Septiembre 2025</h1>
    <div class="controls">
      <button id="btnAdmin" class="btn primary">Entrar como administrador</button>
      <button id="btnExport" class="btn">Exportar CSV</button>
      <span class="notice">ðŸ”’ Solo lectura â€“ usa la contraseÃ±a <b>Urbaser123</b> para editar.</span>
    </div>
  </div>

  <div class="table-wrap">
    <table id="tabla">
      <thead id="thead"></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
  <div class="legend" id="legend"></div>
</div>

<script>
const data = {"employees": [{"name": "Juan Pablo Rueda Romero", "days": ["M", "M", "M", "M", "M", "", "", "M", "M7", "M7", "M7", "M4", "", "", "M", "M2", "M2", "M2", "M2", "", "", "M", "M", "M", "M", "M", "", "", "M", "M"]}, {"name": "Carmelo Perez", "days": ["M7", "M7", "M7", "M7", "M4", "", "", "V", "M", "M", "M", "M", "", "", "V", "M", "M", "M", "M", "", "", "V", "M6", "M6", "M6", "M3", "", "", "V", "M7"]}, {"name": "Victor Garcia", "days": ["M5", "M5", "M5", "M5", "M2", "", "", "M7", "M5", "M5", "M5", "M2", "", "", "M5", "M5", "M5", "M5", "M2", "", "", "M7", "M7", "M7", "M7", "M4", "", "", "M6", "M6"]}, {"name": "Jacsell SaldiÃ±a", "days": ["M5", "M5", "M5", "M5", "M2", "", "", "M6", "M5", "M5", "M5", "M2", "", "", "M5", "M5", "M5", "M5", "M2", "", "", "M6", "V", "V", "V", "V", "", "", "V", "M5"]}, {"name": "Agustina Nahir Faria", "days": ["M2", "M2", "M2", "M2", "M2", "", "", "M5", "M5", "M5", "M5", "M2", "", "", "M7", "M7", "M7", "M7", "M4", "", "", "M2", "M2", "M2", "M2", "M2", "", "", "M7", "M2"]}, {"name": "Hector Salguero", "days": ["BM", "BM", "BM", "BM", "BM", "", "", "BM", "BM", "BM", "BM", "BM", "", "", "BM", "BM", "BM", "BM", "BM", "", "", "BM", "BM", "BM", "BM", "BM", "", "", "BM", "BM"]}, {"name": "* Los horarios pueden variar segÃºn necesidades del Servicio.", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "Turnos URBASER", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "M 7:30 a 15:30", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "M1 7:30 a 16:30", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "M2 8 a 16", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "M3 9 a 17", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "M4 10 a 18", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "M5 8 a 17", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "M6 9 a 18", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "M7 10 a 19", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "M8 8 a 15", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "PR Perm. Retribuido", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "C Compensado", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "FL Fiesta local", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "FN Fiesta nacional", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "V Vacaciones", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "BE Baja de empresa", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "BM Baja mÃ©dica", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}, {"name": "CV confirmar vacas", "days": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]}], "month": 9, "year": 2025, "turnoColores": {"M": "FFF176", "M1": "FFD54F", "M2": "FFB74D", "M3": "FF8A65", "M4": "EF5350", "M5": "EC407A", "M6": "AB47BC", "M7": "7E57C2", "M8": "5C6BC0", "V": "66BB6A", "PR": "42A5F5", "C": "26C6DA", "FL": "26A69A", "FN": "9CCC65", "BE": "8D6E63", "BM": "78909C", "CV": "BDBDBD"}, "turnoInfo": {"M": {"horas": "8H", "horario": "07:30 a 15:30"}, "M1": {"horas": "9H", "horario": "07:30 a 16:30"}, "M2": {"horas": "8H", "horario": "08:00 a 16:00"}, "M3": {"horas": "8H", "horario": "09:00 a 17:00"}, "M4": {"horas": "8H", "horario": "10:00 a 18:00"}, "M5": {"horas": "9H", "horario": "08:00 a 17:00"}, "M6": {"horas": "9H", "horario": "09:00 a 18:00"}, "M7": {"horas": "9H", "horario": "10:00 a 19:00"}, "M8": {"horas": "7H", "horario": "08:00 a 15:00"}, "PR": {"horas": "", "horario": "Permiso retribuido"}, "C": {"horas": "", "horario": "DÃ­a compensado"}, "FL": {"horas": "", "horario": "Festivo Local"}, "FN": {"horas": "", "horario": "Festivo Nacional"}, "V": {"horas": "", "horario": "Vacaciones"}, "BE": {"horas": "", "horario": "Baja de Empresa"}, "BM": {"horas": "", "horario": "Baja MÃ©dica"}, "CV": {"horas": "", "horario": "Pendiente confirmar vacaciones"}}};
const PASSWORD = "Urbaser123";

function diasEnMes(m, y) { return new Date(y, m, 0).getDate(); }
const diasSemana = ["Dom","Lun","Mar","MiÃ©","Jue","Vie","SÃ¡b"];

let turnoColores = data.turnoColores;
let turnoInfo = data.turnoInfo;
let empleados = JSON.parse(JSON.stringify(data.employees));
let mes = data.month;
let anio = data.year;
let editable = false;

const thead = document.getElementById('thead');
const tbody = document.getElementById('tbody');
const legend = document.getElementById('legend');

function setEditable(on) {
  editable = !!on;
  [...tbody.querySelectorAll('td.turno')].forEach(td => td.contentEditable = on);
}

document.getElementById('btnAdmin').addEventListener('click', () => {
  const p = prompt("Introduce la contraseÃ±a de administrador:");
  if (p === PASSWORD) setEditable(true);
  else alert("ContraseÃ±a incorrecta.");
});

function pintarLegend() {
  legend.innerHTML = '';
  const order = ["M","M1","M2","M3","M4","M5","M6","M7","M8","V","PR","BM","BE","CV","FL","FN","C"];
  order.forEach(code => {
    const info = turnoInfo[code];
    if (!info) return;
    const wrap = document.createElement('div');
    wrap.className = 'item';
    const sw = document.createElement('div');
    sw.className = 'swatch';
    sw.style.background = '#' + (turnoColores[code] || 'FFFFFF');
    const txt = document.createElement('span');
    const det = info.horas ? ` (${info.horas} â€“ ${info.horario})` : ` (${info.horario})`;
    txt.textContent = `${code}${det}`;
    wrap.appendChild(sw); wrap.appendChild(txt);
    legend.appendChild(wrap);
  });
}

function render() {
  const dcount = diasEnMes(mes, anio); // 30
  thead.innerHTML = '';

  // Fila 1: nÃºmeros
  const tr1 = document.createElement('tr');
  const thName = document.createElement('th');
  thName.textContent = 'Nombre y Apellidos';
  thName.className = 'name sticky';
  thName.rowSpan = 2;
  tr1.appendChild(thName);
  for (let d=1; d<=dcount; d++) {
    const th = document.createElement('th');
    th.textContent = d;
    th.className='sticky';
    tr1.appendChild(th);
  }
  thead.appendChild(tr1);

  // Fila 2: dÃ­as semana
  const tr2 = document.createElement('tr');
  for (let d=1; d<=dcount; d++) {
    const th = document.createElement('th');
    const fecha = new Date(anio, mes-1, d);
    th.textContent = diasSemana[fecha.getDay()];
    th.className='sticky';
    tr2.appendChild(th);
  }
  thead.appendChild(tr2);

  tbody.innerHTML = '';
  empleados.forEach(emp => {
    const tr = document.createElement('tr');
    const tdName = document.createElement('td');
    tdName.textContent = emp.name || '';
    tdName.className = 'name';
    tr.appendChild(tdName);
    for (let i=0; i<dcount; i++) {
      const td = document.createElement('td');
      td.className = 'turno';
      const val = (emp.days && emp.days[i]) ? String(emp.days[i]).toUpperCase() : '';
      td.textContent = val;
      if (turnoColores[val]) td.style.background = '#' + turnoColores[val];
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  });

  setEditable(false);
  pintarLegend();
}

document.getElementById('btnExport').addEventListener('click', () => {
  const dcount = diasEnMes(mes, anio);
  let csv = 'Nombre';
  for (let d=1; d<=dcount; d++) csv += ';' + d;
  csv += '\n';
  [...tbody.rows].forEach((row, idx) => {
    const emp = empleados[idx];
    csv += (emp && emp.name) ? emp.name : '';
    for (let d=0; d<dcount; d++) {
      const cell = row.cells[d+1];
      csv += ';' + (cell ? cell.textContent.trim() : '');
    }
    csv += '\n';
  });
  const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `cuadrante_${anio}_${mes}.csv`;
  a.click();
});

render();
</script>
</body>
</html>
